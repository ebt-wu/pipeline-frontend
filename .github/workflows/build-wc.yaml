name: Build WebComponent Workflow
on:
  push:
    paths:
      - '.github/workflows/build-wc.yaml'
      - 'projects/webcomponent/**'
      - 'yarn.lock'
      - 'package.json'

jobs:
  buildPackages:
    uses: dxp/.github/.github/workflows/job--ng-build.yaml@main
    secrets: inherit
    with:
      artifact: pipeline-frontend-wc
      build_command: 'yarn build:wc'
      test_command: 'yarn test:wc:cov'
      release_prefix: wc-
      lint: false

  updateStack:
    needs: [buildPackages]
    if: ${{ github.ref == 'refs/heads/main' }}
    uses: dxp/.github/.github/workflows/update-stack.yaml@main
    with:
      stackRepo: hyperspace/automaticd-stack
      stackRepoBranch: dev
      componentVersionKey: pipelineFrontendWebcomponent
      version: wc-${{ needs.buildPackages.outputs.version }}
    secrets:
      GH_ACCESS_TOKEN: ${{ secrets.GH_HYPERSPACE_USER_TOKEN }}
